<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>myitme</title>
    <link rel="stylesheet" href="../css/dlandzc.css">
    <link rel="stylesheet" href="../css/base.css">
    <link rel="stylesheet" href="../css/page.css">
    <link rel="stylesheet" href="../css/bootstrap.css">
    <script src="../lib/jquery-3.2.1.js"></script>
    <script src="../js/index.js"></script>
    <script src="../js/common.js"></script>
    <script>
        /*
            练习：实现注册成功后跳转到登录页面，并输入用户名密码登录
            */
        document.addEventListener('DOMContentLoaded',()=>{
            let username = document.querySelector('#username');
            let password = document.querySelector('#password');
            let btnReg = document.querySelector('.btnReg');

            let status = [200,304];

            let isok = false;

            username.focus();

            // 注册
            btnReg.onclick = ()=>{
                if(!isok){
                    return false;
                }

                // 获取用户名/密码
                let _username = username.value;
                var _password = password.value;

                let xhr = new XMLHttpRequest();
                xhr.onload = ()=>{
                    if(status.indexOf(xhr.status) >= 0){
                        console.log(xhr.responseText);
                    }
                }
                xhr.open('post','../api/reg.php',true);

                // 设置请求头，以便后端接收post数据
                xhr.setRequestHeader('Content-Type','application/x-www-form-urlencoded');


                xhr.send(`username=${_username}&password=${_password}`);
                location.href = 'zccg.html';
            }


            // 验证用户名是否存在
            username.onblur = ()=>{
                let _username = username.value;

                let xhr = new XMLHttpRequest();
                
                xhr.onload = ()=>{
                    if(status.indexOf(xhr.status) >= 0){
                        var formGroup = username.parentNode;
                        if(xhr.responseText === 'yes'){
                            isok = true;

                            // 成功：添加has-success类
                            formGroup.classList.remove('has-error');
                            formGroup.classList.add('has-success');
                            username.nextElementSibling.innerText = '';
                        }else if(xhr.responseText === 'no'){
                            isok = false;
                            formGroup.classList.remove('has-success');
                            formGroup.classList.add('has-error');
                            username.nextElementSibling.innerText = '用户名已存在';
                        }
                    }
                }
                xhr.open('get','../api/check_username.php?username='+_username,true);
                xhr.send();


            }
        });
    </script>
</head>
<body>
    <!-- head头部 -->
    <div class="indexbox">
        <div class="head_top">
            <div class="container">
                <ul class="head_tl fl" >
                    <li>欢迎光临莎莎网！</li>
                    <li>
                        <a href="#">登录</a>或<a href="">免费注册</a>
                    </li>
                </ul> 
                <ul class="head_tr fr" >
                    <li class="idxnavt"><a href="#">
                        <i></i>
                        我的账户
                        <i></i>
                            </a>
                            <dl class="myzh">
                                <dd><a href="#">我的订单</a></dd>
                                <dd><a href="#">我的积分</a></dd>
                                <dd><a href="#">我的优惠券</a></dd>
                                <dd><a href="#">我的收藏</a></dd>
                                <dd><a href="#">我的评价</a></dd>    
                            </dl>
                    </li>
                    <li class="mycar"><a href="#">
                        <i></i>
                        我的购物车
                        <dl class="mycarlist"></dl>
                    </a></li>
                    <li><a href="#">
                        <i></i>
                        我的收藏
                    </a></li>
                    <li><a href="#">我的站内信息</a></li>
                    <li><a href="#">积分中心</a></li>
                    <li><a href="#">Global site</a></li>
                    <li>
                        <div class="head_last">
                            <a href="#">关注我们</a>
                            <a href="https://weibo.com/sasahongkong?is_hot=1" class="wb ewmf">
                                <img src="../img/index/head/xl.png" alt="">
                                <i class="wber"></i>
                            </a>
                            <a href="https://wx.qq.com/" class="wx ewmf">
                                <img src="../img/index/head/wx.png" alt="">
                                <i class="wxer "></i>
                            </a>
                        </div>
                    </li>
                </ul>  
            </div>
        </div>
        <!-- 搜索部分 -->
        <div class="page-rs">
            <div class="container">
                <!-- logo -->
                <div class="sotelogo-rs clearfix">    
                    <a href="#" targer="_blank">
                        <img src="../img/index/head/logo.png" alt="莎莎网" >
                    </a>
                </div>
            </div>
        </div>

            <!-- 注册部分 -->
            <div class="zhuce">
                <div class="container">
                    <div class="zcnr">
                        <!-- 注册表 -->
                        <div class="zcnr_r fr">
                            <div class="sign-title clearfix">
                                <h3 class="zcbt fl">注册账号</h3>
                                <p class="tzdl fr">
                                    已有莎莎网账号？
                                    <a href="Login.html">立即登录</a>
                                </p>
                            </div>
                            <!-- 信息填写 -->
                            <form action="" method="post" class="form-horizontal">
                                <div class="form-group">
                                    <label for="username"></label>
                                    <input type="email" id="username" name="username" 
                                    class="form-control input-ls"
                                    placeholder="请输入邮箱/手机号，最少5个字符">
                                    <span class="help-block"></span>
                                    
                                </div>
                                    <div class="form-group">
                                            <label for="password"></label>
                                            <input type="password" id="password" name="password" 
                                            class="form-control input-ls"
                                            placeholder="请输入密码6-16位字母和数字的组合">
                                            
                                        </div>
                                    <div class="form-group">
                                            <label for="passwords"></label>
                                            <input type="password" id="passwords" name="passwords" 
                                            class="form-control input-ls"
                                            placeholder="再次填写密码">
                                            
                                    </div>
                                    <div class="form-group col-xs-5 yzbox">
                                            <label for="code"></label>
                                            <input type="text" id="code" name="code" 
                                            class="form-control input-ls"
                                            placeholder="填写验证码">
                                        <div class="codenum"></div>
                                    </div>
                                <div class="form-group">
                                    <button class="btn btn-success btnReg btn-block">注册</button>
                                </div>
                            </form>
                        </div>
                        </div>
                        <div class="zcnr_l fr">
                            <img src="../img/dlandzc/zc.jpg" alt="">
                        </div>
                    </div>
                </div>
            </div>
</body>
</html>